<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube直播付费消息展示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Noto Sans', sans-serif;
            background: #0f0f0f;
            color: #fff;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
            font-weight: 500;
        }

        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #aaa;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        #app {
            background: #1f1f1f;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        yt-live-chat-renderer {
            display: block;
            height: 80px;
            position: relative;
        }

        yt-live-chat-ticker-renderer {
            display: block;
            height: 100%;
        }

        #container {
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        #items {
            display: flex;
            height: 100%;
            align-items: center;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 0 10px;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        #items::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        yt-live-chat-ticker-paid-message-item-renderer {
            flex-shrink: 0;
            margin-right: 8px;
            border-radius: 20px;
            overflow: hidden;
            transition: transform 0.2s;
        }

        yt-live-chat-ticker-paid-message-item-renderer:hover {
            transform: scale(1.05);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        button {
            background: #272727;
            color: #fff;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        button:hover {
            background: #3d3d3d;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            color: #aaa;
            font-size: 14px;
        }

        .info-panel {
            background: #272727;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .info-panel h2 {
            margin-bottom: 15px;
            font-weight: 500;
            color: #fff;
        }

        .info-panel p {
            margin-bottom: 10px;
            line-height: 1.6;
            color: #ddd;
        }

        .highlight {
            color: #3ea6ff;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube直播付费消息效果展示</h1>

        <p class="description">
            这是一个模拟YouTube直播中付费消息水平滚动效果的演示。每个消息都有独立的倒计时，当进度条降至1%时会自动移除。
            您可以使用下方的按钮添加不同类型的付费消息。
        </p>

        <div class="controls">
            <button id="add-small">添加小金额 (CN¥39.00)</button>
            <button id="add-medium">添加中金额 (CN¥500)</button>
            <button id="add-large">添加大金额 (CN¥1,000)</button>
            <button id="add-membership">添加会员消息</button>
            <button id="add-orange">添加橙色金额 (CN¥200)</button>
            <button id="add-yellow">添加黄色金额 (CN¥50.00)</button>
            <button id="add-random">添加随机消息</button>
            <button id="clear-all">清空所有消息</button>
        </div>

        <div id="app">
            <yt-live-chat-renderer class="style-scope yt-live-chat-app" hide-timestamps="" style="--scrollbar-width: 11px;">
                <yt-live-chat-ticker-renderer class="style-scope yt-live-chat-renderer">
                    <div class="style-scope yt-live-chat-ticker-renderer" dir="ltr" id="container">
                        <div class="style-scope yt-live-chat-ticker-renderer" id="items">
                            <!-- 付费消息将在这里动态添加 -->
                        </div>
                    </div>
                </yt-live-chat-ticker-renderer>
            </yt-live-chat-renderer>
        </div>

        <div class="stats">
            <div>当前消息数量: <span id="message-count">0</span></div>
            <div>已移除消息: <span id="removed-count">0</span></div>
        </div>

        <div class="info-panel">
            <h2>功能说明</h2>
            <p>• 每个付费消息都有独立的倒计时，从100%逐渐降至1%</p>
            <p>• 倒计时结束后，消息会自动从列表中移除</p>
            <p>• 消息支持水平滚动，模拟YouTube直播的实际效果</p>
            <p>• 不同类型的消息有不同的颜色和样式</p>
            <p>• 鼠标悬停在消息上会有轻微的放大效果</p>
        </div>
    </div>

    <script>
        // 付费消息类
        class PaidMessageTicker {
            constructor(options = {}) {
                this.config = {
                    // 基础配置
                    width: '106px',
                    text: 'CN¥39.00',
                    avatarSrc: './blivechat_files/noface.gif',

                    // 颜色配置
                    primaryColor: 'rgb(29, 233, 182)',
                    secondaryColor: 'rgb(0, 191, 165)',

                    // 倒计时配置
                    initialPercentage: 100,
                    countdownDuration: 10000, // 毫秒
                    countdownInterval: 50, // 更新间隔（毫秒）

                    // 回调函数
                    onRemove: null,
                    onUpdate: null,

                    ...options
                };

                this.currentPercentage = this.config.initialPercentage;
                this.countdownInterval = null;
                this.startTime = null;
                this.element = null;

                this.init();
            }

            init() {
                this.createElement();
                this.startCountdown();
            }

            createElement() {
                this.element = document.createElement('yt-live-chat-ticker-paid-message-item-renderer');
                this.element.className = 'style-scope yt-live-chat-ticker-renderer';
                this.element.style.overflow = 'hidden';
                this.element.style.width = this.config.width;
                this.element.tabIndex = 0;

                this.updateElement();
            }

            updateElement() {
                const gradientStyle = `linear-gradient(90deg, ${this.config.primaryColor}, ${this.config.primaryColor} ${this.currentPercentage}%, ${this.config.secondaryColor} ${this.currentPercentage}%, ${this.config.secondaryColor})`;

                this.element.innerHTML = `
                    <div class="style-scope yt-live-chat-ticker-paid-message-item-renderer" dir="ltr" id="container"
                         style="background: ${gradientStyle};">
                        <div class="style-scope yt-live-chat-ticker-paid-message-item-renderer" id="content"
                             style="color: ${this.getTextColor()};">
                            <yt-img-shadow class="no-transition style-scope yt-live-chat-ticker-paid-message-item-renderer"
                                          height="24" id="author-photo" loaded=""
                                          style="background-color: transparent;" width="24">
                                <img alt="" class="style-scope yt-img-shadow" height="24" id="img"
                                     src="${this.config.avatarSrc}" width="24">
                            </yt-img-shadow>
                            <span class="style-scope yt-live-chat-ticker-paid-message-item-renderer" dir="ltr"
                                  id="text">${this.config.text}</span>
                        </div>
                    </div>
                `;
            }

            getTextColor() {
                // 根据背景颜色亮度自动选择合适的文字颜色
                const primaryColor = this.config.primaryColor;
                const rgbMatch = primaryColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);

                if (rgbMatch) {
                    const r = parseInt(rgbMatch[1]);
                    const g = parseInt(rgbMatch[2]);
                    const b = parseInt(rgbMatch[3]);

                    // 计算亮度 (使用相对亮度公式)
                    const brightness = (r * 0.299 + g * 0.587 + b * 0.114) / 255;

                    return brightness > 0.5 ? 'rgb(0, 0, 0)' : 'rgb(255, 255, 255)';
                }

                return 'rgb(255, 255, 255)'; // 默认白色
            }

            startCountdown() {
                this.startTime = Date.now();

                this.countdownInterval = setInterval(() => {
                    const elapsed = Date.now() - this.startTime;
                    const progress = elapsed / this.config.countdownDuration;

                    this.currentPercentage = Math.max(1, this.config.initialPercentage - (progress * (this.config.initialPercentage - 1)));

                    this.updateElement();

                    // 触发更新回调
                    if (this.config.onUpdate) {
                        this.config.onUpdate(this.currentPercentage, this);
                    }

                    // 检查是否应该删除
                    if (this.currentPercentage <= 1) {
                        this.remove();
                    }
                }, this.config.countdownInterval);
            }

            remove() {
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                    this.countdownInterval = null;
                }

                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }

                // 触发删除回调
                if (this.config.onRemove) {
                    this.config.onRemove(this);
                }
            }

            // 手动更新百分比
            setPercentage(percentage) {
                this.currentPercentage = Math.max(1, Math.min(100, percentage));
                this.updateElement();
            }

            // 获取DOM元素
            getElement() {
                return this.element;
            }

            // 销毁实例
            destroy() {
                this.remove();
            }

            // 预设模板方法
            static createSmallAmount(amount, duration = 10000) {
                return new PaidMessageTicker({
                    width: '106px',
                    primaryColor: 'rgb(29, 233, 182)',
                    secondaryColor: 'rgb(0, 191, 165)',
                    text: `CN¥${amount}`,
                    countdownDuration: duration
                });
            }

            static createMediumAmount(amount, duration = 10000) {
                return new PaidMessageTicker({
                    width: '94px',
                    primaryColor: 'rgb(233, 30, 99)',
                    secondaryColor: 'rgb(194, 24, 91)',
                    text: `CN¥${amount}`,
                    countdownDuration: duration
                });
            }

            static createLargeAmount(amount, duration = 10000) {
                return new PaidMessageTicker({
                    width: '106px',
                    primaryColor: 'rgb(230, 33, 23)',
                    secondaryColor: 'rgb(208, 0, 0)',
                    text: `CN¥${amount}`,
                    countdownDuration: duration
                });
            }

            static createMembership(duration = 10000) {
                return new PaidMessageTicker({
                    width: '72px',
                    primaryColor: 'rgb(15, 157, 88)',
                    secondaryColor: 'rgb(11, 128, 67)',
                    text: '会员',
                    countdownDuration: duration
                });
            }

            static createOrangeAmount(amount, duration = 10000) {
                return new PaidMessageTicker({
                    width: '94px',
                    primaryColor: 'rgb(245, 124, 0)',
                    secondaryColor: 'rgb(230, 81, 0)',
                    text: `CN¥${amount}`,
                    countdownDuration: duration
                });
            }

            static createYellowAmount(amount, duration = 10000) {
                return new PaidMessageTicker({
                    width: '106px',
                    primaryColor: 'rgb(255, 202, 40)',
                    secondaryColor: 'rgb(255, 179, 0)',
                    text: `CN¥${amount}`,
                    countdownDuration: duration
                });
            }
        }

        // 管理器类，用于管理多个付费消息
        class PaidMessageTickerManager {
            constructor() {
                this.tickers = new Set();
                this.removedCount = 0;
                this.itemsContainer = document.getElementById('items');
                this.messageCountElement = document.getElementById('message-count');
                this.removedCountElement = document.getElementById('removed-count');

                this.updateStats();
            }

            createTicker(options) {
                const ticker = new PaidMessageTicker({
                    ...options,
                    onRemove: (removedTicker) => {
                        this.tickers.delete(removedTicker);
                        this.removedCount++;
                        this.updateStats();

                        if (options.onRemove) {
                            options.onRemove(removedTicker);
                        }
                    }
                });

                this.tickers.add(ticker);
                this.itemsContainer.appendChild(ticker.getElement());
                this.updateStats();

                return ticker;
            }

            removeAll() {
                this.tickers.forEach(ticker => ticker.destroy());
                this.tickers.clear();
                this.updateStats();
            }

            getCount() {
                return this.tickers.size;
            }

            updateStats() {
                this.messageCountElement.textContent = this.getCount();
                this.removedCountElement.textContent = this.removedCount;
            }
        }

        // 初始化管理器
        const manager = new PaidMessageTickerManager();

        // 添加事件监听器
        document.getElementById('add-small').addEventListener('click', () => {
            manager.createTicker({
                width: '106px',
                primaryColor: 'rgb(29, 233, 182)',
                secondaryColor: 'rgb(0, 191, 165)',
                text: 'CN¥39.00',
                countdownDuration: 8000
            });
        });

        document.getElementById('add-medium').addEventListener('click', () => {
            manager.createTicker({
                width: '94px',
                primaryColor: 'rgb(233, 30, 99)',
                secondaryColor: 'rgb(194, 24, 91)',
                text: 'CN¥500',
                countdownDuration: 10000
            });
        });

        document.getElementById('add-large').addEventListener('click', () => {
            manager.createTicker({
                width: '106px',
                primaryColor: 'rgb(230, 33, 23)',
                secondaryColor: 'rgb(208, 0, 0)',
                text: 'CN¥1,000',
                countdownDuration: 12000
            });
        });

        document.getElementById('add-membership').addEventListener('click', () => {
            manager.createTicker({
                width: '72px',
                primaryColor: 'rgb(15, 157, 88)',
                secondaryColor: 'rgb(11, 128, 67)',
                text: '会员',
                countdownDuration: 15000
            });
        });

        document.getElementById('add-orange').addEventListener('click', () => {
            manager.createTicker({
                width: '94px',
                primaryColor: 'rgb(245, 124, 0)',
                secondaryColor: 'rgb(230, 81, 0)',
                text: 'CN¥200',
                countdownDuration: 9000
            });
        });

        document.getElementById('add-yellow').addEventListener('click', () => {
            manager.createTicker({
                width: '106px',
                primaryColor: 'rgb(255, 202, 40)',
                secondaryColor: 'rgb(255, 179, 0)',
                text: 'CN¥50.00',
                countdownDuration: 7000
            });
        });

        document.getElementById('add-random').addEventListener('click', () => {
            const types = [
                () => manager.createTicker({
                    width: '106px',
                    primaryColor: 'rgb(29, 233, 182)',
                    secondaryColor: 'rgb(0, 191, 165)',
                    text: 'CN¥39.00',
                    countdownDuration: 8000
                }),
                () => manager.createTicker({
                    width: '94px',
                    primaryColor: 'rgb(233, 30, 99)',
                    secondaryColor: 'rgb(194, 24, 91)',
                    text: 'CN¥500',
                    countdownDuration: 10000
                }),
                () => manager.createTicker({
                    width: '106px',
                    primaryColor: 'rgb(230, 33, 23)',
                    secondaryColor: 'rgb(208, 0, 0)',
                    text: 'CN¥1,000',
                    countdownDuration: 12000
                }),
                () => manager.createTicker({
                    width: '72px',
                    primaryColor: 'rgb(15, 157, 88)',
                    secondaryColor: 'rgb(11, 128, 67)',
                    text: '会员',
                    countdownDuration: 15000
                })
            ];

            const randomType = types[Math.floor(Math.random() * types.length)];
            randomType();
        });

        document.getElementById('clear-all').addEventListener('click', () => {
            manager.removeAll();
        });

        // 初始添加一些示例消息
        setTimeout(() => {
            manager.createTicker({
                width: '106px',
                primaryColor: 'rgb(29, 233, 182)',
                secondaryColor: 'rgb(0, 191, 165)',
                text: 'CN¥39.00',
                countdownDuration: 8000
            });
        }, 500);

        setTimeout(() => {
            manager.createTicker({
                width: '94px',
                primaryColor: 'rgb(233, 30, 99)',
                secondaryColor: 'rgb(194, 24, 91)',
                text: 'CN¥500',
                countdownDuration: 10000
            });
        }, 1500);

        setTimeout(() => {
            manager.createTicker({
                width: '106px',
                primaryColor: 'rgb(230, 33, 23)',
                secondaryColor: 'rgb(208, 0, 0)',
                text: 'CN¥1,000',
                countdownDuration: 12000
            });
        }, 2500);
    </script>
</body>
</html>